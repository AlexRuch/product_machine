# Software Requirements Specification

## Введение (Introduction)
- #### Назначение (Purpose)

Проект разработан с целью изучения технологий создания web-приложений, изучения технологий программирования.   

   Система "CoffeeMachine" представляет собой виртуальную модель кофейного автомата предоставляющего возможности:  
 -   регистрации  
 -   просмотра каталога товаров  
 -   покупки товаров из представленного каталога  
 -   пополнения счёта
 -   просмотра истории покупок  
 -   формирвоание каталога товаров     
 -   управления товарным запасом
 -   формирование отчетов  


- #### Сокращения и условные обозначения (Document conventions)

   Гость(guest) - пользователь не зарегестрирвоанный в системе   
   Покупатель(customer) - пользователь зарегестрированный в системе   
   Администратор(admin) - пользователь обладающий правами администратора в системе  
   Счет(account) - количество у.е. за которые покупатель может купить товар  
   Транзакция - действие выполняемое со счетом покупательа  
   Продукт - кофе  
   Кабинет покупателя - раздел системы в котором отображаются транзакции и есть возможность пополнения счёта  
   Корзина - список продуктов которые выбрал покупатель для покупки.  


## Общее описание (Overall Description)

Система представляет собой клиент-серверное веб-приложение.
В качестве клиента выступает веб-браузер пользователя. В качестве сервера выступает программа написанная при момощи технологий JSF и JPA, принимающая запросы от клиента и возвращая клиенту соответствующие веб-страницы.

Клиентская часть - это интерфейс, предоставляющий пользователю возможость формирования каталога товаров, просмотра каталога, регистрации, получении информации о состоянии счёта, формировании заказа, отслеживания остатков по товарным позициям , форирования отчетов.

Доступ пользователя к тем или иным возможностям системы определяется его ролью в системе. Система поддерживает три роли: "гость", "покупатель", "администратор".      

- #### Возможности продукта (Product features)
При входе на сайт, пользователь попадает на гостевую страницу, где он может ознакомиться с ассортиментом продуктов, предоставляемых системой, но покупки для гостя не доступны. Гостевая страница имеет ссылку на страницу входа в защищенную зону для покупателей.  
Если пользователь не зарегестрирован в системе, то со страницы входа он может перейти на страницу регистрации в системе. При регистрации пользователь должен заполнить поля:  
e-mail(он же будет логином для входа в защищенную зону для покупателей)  
password  
confirm password  
При регистрации система проверяет уникальность учетных данных. Если в системе данные не являются уникальными, то регистрации нового пользователя не произойдет и он будет перенаправлен на страницу ошибки. При выполнении условий регистрации, пользователь будет занесен в систему, на его счету будет находиться 0 у.е. и он будет перенаправлен на страницу входа в защищенную область для покупателей.  
Попадая в защищенную область покупателей, пользователь получает возможность покупать продукты, пополнять свой баланс, просматривать свои транзакции.  
Покупка осуществляется путем добавления продуктов в корзину и последующую их оплату со своего счета. При нехватке средств на оплату продуктов в корзине, покупателю выведется сообщение об ошибке в котором ему будет предложено убрать некоторые продукты из корзины или пополнить свой счёт.
При успешной покупке,  происходит обновление данных о транзакциях, со счета покупателя списываются стоимость покупки, на складе происходит обновление данных об остатках продуктов, корзина покупателя обнуляется, данные о покупке(количество и наименование продуктов, дата покупки) сохраняются в системе и доступны администратору и покупателю. После завершения покупки, любые изменения в заказе невозможны.  
В защещенную зону администратора можно попасть только явно указав адрес страницы администрирования. При переходе в защещенную зону администратора, система требует ввести логин и пароль. Администратор может быть назначен только напрямую через базу данных.   
Система предоставляет возможность администратору отслеживать заказы и формировать каталог.


Роль "гость" присваивается пользователю по умолчанию при обращении к системе.

"Гость" имеет следующие возможности:  
- просмотр ассортимента кофе представленного системой
- регистрация в системе
- вход в систему для изменения статуса на "покупатель"

Роль "покупатель" может иметь только зарегестрированный в системе пользователь. Для того, чтобы получить статус "покупатель", гость должен перейти на страницу входа и ввести логин и пароль которые он указал при регистрации.

"Покупатель" имеет следующие возможности:  
- добавление кофе из представленного системой каталога в корзину
- пополнение своего счета через кабинет покупателя
- просмотр истории своих покупок в кабинете покупателя
- покупка кофе содержащегося в корзине  

Роль "администратор" можно получить только перейдя по прямой ссылке в раздел администрирования и выполнив вход в данный раздел. Статус администратора нельзя получить при регистрации.

"Администратор" имеет следующие возможности:  
- пополнение количества кофе находящегося в системе
- получение информации о покупках сделанных покупателем (продукты, сумма покупки, дата)
- формировние каталога




- #### Требования к ПО (Operating environment)

   OS: Linux/UNIX  
   JDK 8  
   JAVA EE 7  
   Wildfly 10.x  
   Postgresql 9   
   jdbc-postgresql-driver


## Функциональность системы (System features)

- ### Функциональный блок "CoffeeMachine_DB"

Система "CoffeeMachine" работает с базой данных со следующией структурой:

 > #### название таблицы - назначение
 - название поля(для чего предназначено)

##### USERS (В данной таблице содержится информация о пользователях системы)  
 - user_id (Уникальный идентификатор пользователя. Первичный ключ)
 - user_email (E-mail пользователя, который является логином для входа в систему)
 - user_password (Пароль пользователя)
 - user_role (Роль пользвателя в системе)
 - user_account (счет пользователя)


##### ACCOUNT_INFO (В данной таблице содержится информация об операциях проводимых со счетом пользователя)  
 - account_id (Уникальный идентификатор записи. Первичный ключ)  
 - user_id (id пользователя со счетом которого проводилась операция)  
 - money_transaction (Сумма которая была списана со счета или на которую пополнился счет пользователя)  
 - transaction_date (Дата проводимой операции)


##### ORDER (В данной таблице содержится информация о том, какой(ие) заказ(ы) принадлежит(ат) пользователю)  
- order_id (Уникальный идентификатор заказа. Первичный ключ)
- user_id (id пользователя которому принадлежит заказ)
- order_cost (Стоимость заказа)
- order_date (Дата, когда был сделан заказ)


##### ORDERED_PRODUCTS (В данной таблице содержится информация о заказе)
- ordered_id (Уникальный идентификатор. Первичный ключ)
- product_id (id продукта который находится на складе)
- product_quantity (количество продуктов в заказе)
- order_id (id заказа в котором содержатся продукты)

##### PRODUCTS (В данной таблице содержится информация о продуктах находящихся на складе)
- product_id (Уникальный идентификатор продукта. Первичный ключ)
- product_name (Название продукта)
- product_cost (Стоимость продукта)
- product_quantity (Количество продуктов данного наименование имеющихся на складе)


Взаимодействие системы с базой данных происходит по следующему принцыпу:

При регистрации пользователя, после того как вводимые пользователем данные пройдут через фильтр(проверяет корректность вводимых данных на соответствие шаблонам) на стороне клиента, данные поступают на сервер, где происходит проверка на уникальность e-mail'а в базе данных (Выполняется запрос с поиском к таблице USERS). Если e-mail указываемеый пользователем при регистрации уже существует в базе данных(Результат запроса к таблице USERS не равен null), то новая запись/изменение записи не происходит. Если e-mail указываемый пользователем не содержится в базе данных(Результат запроса к таблице USERS не равен null), то в базу данных заносятся следующие данные:  
USERS:  
- id - генерируется автоматически
- user_email - записывается e-mail указанный пользователем при регистрации
- user_password - записывается пароль указанный пользователем при регистрации
- user_role - записывается значение "user", являющееся значение по умолчанию
- user_account - записывается 0.0

После того как пользователь сформировал заказ в своей корзине(добавил продукты в корзину и сумма заказа меньше суммы находящейся на аккаунте пользователя) и нажал кнопку "Отправить", происходит обращение к базе данных, до этого момента(формирование заказа в корзине) никакие запросы к базе данных не отправляются.
Действия, происходящие после нажатия кнопки "Отправить":
- запрос к базе данных (запрос к таблице PRODUCTS) который проверяет наличие товара указанного пользователем(во время формирования корзины другой пользователь может купить тот же товар и его не останется на складе)
Если необходимого товара не будет на складе, пользователь попадёт на страницу ошибки и дальнейшие запросы к базе данных выполнены не будут.
- запрос к базе данных который заносит в таблицу ORDER_PRODUCTS следующие данные:  
id - генерируется автоматически  
product_id - id продукта выбранного пользователем  
product_quantity - количество продуктов одинакого наименования, выбранных пользователем

-  запрос к базе данных, добавляющий запись в таблицу ORDER:  
id - генерируется автоматически
user_id - записывается id пользователя совершившего заказ

- запрос к базе данных который заносит в таблицу ORDER_PRODUCTS следующие данные:  
order_id - записывается id заказа принадлежащего пользователю

- Запись стоимости заказа, сформированной в корзине пользователя в поле order_cost таблицы USER_ORDER

- Запрос к базе данных который отнимает сумму заказа от счета пользователя


- ### Функциональный блок  "Интерфейс"

Ниже описан интерфейс под каждую группу доступа.

- ##### Гость
При входе на сайт пользователь видит каталог продуктов доступных для покупки.
В шапке сайта располагается кнопка "Take it!", при нажатии на которую пользователь попадает на страницу входа в систему.
На странице входа в систему находятся следующие поля: "e-mail", "password", кнопка "submit"  и кнопка "registration".
Если пользователь уже зарегистрирован в системе, то он заполняет поля "e-mail" и "password" данными указанными при регистрации, нажимает на кнопку "submit" и попадает в зону для покупателей.
Если данные введённые в поля окажутся неправильными, пользователь будет перенаправлен на страницу ошибки.
Если пользователь не зарегистрирован в системе, то при нажати на кнупку "registration" он попадает на страницу регистрации, где  есть следующие поля: "e-mail", "password", "confirm password". Все поля обязательны для заполнения. Поле "e-mail" проверяется на валидность. Данные в поле e-mail должны иметь структуру: "заглавные/строчные буквы/цифры/знаки препинания"@"строчные буквы"."строчные буквы". Если данные введеные в поле "e-mail" не соответствуют этой структуре, будет выведено сообщение об ошибке.
Данные в полях "password" и "confirm password" должны совпадать и их длинна должна быть не меньше 6 символов, в противном случае будет выведено сообщение об ошибке.
Когда поля "e-mail", "password", "confirm password" будут заполнены и не будет выведено никаких ошибок пользователь должен нажать на кнопку "submit"  для продолжения регистрации. Регистрация считается пройденной успешно, если пользователь с введённым e-mail до этого не был зарегистрирован в системе. После успешного прохождения регистрации, пользователь будет перенаправлен на страницу с указанием того, что регистрация пройдена успешна и он может войти в систему и начать совершать покупки. Если пользователь пытается зарегистрироваться с помошью e-mail который уже есть в базе данных,  то он будет перенаправлен на страницу ошибки.

- ##### Покупатель
При входе на сайт в роли покупателя, пользователь попадает на страницу сайна на которой представлена таблица с каталогом товаров. У каждого товара есть кнопка "Add", добавляющая выбраный товар в корзину.
 В шапке сайта распологаются следующие   ссылки: "account", "shopping cart", "log out".
 account -  при переходе по ссылке пользователь попадает в свой кабинет, где может пополнить свой баланс.
 "shopping cart" - при переходе по ссылке пользователь попадает в свою корзину, в которой отображаются выбранные им продукты и есть кнопка подтверждения заказа.
 "log out" - при переходе по ссылке пользователь выходит из защищенной зоны для покупателей и попадает в зону для гостей.   


 - ##### Администратор
 При входе на сайт в роли администратора, пользователь попадает на страницу на которой представлена таблица с количеством продуктов оставшихся на складе. Адинистратор имеет возможнсоть формировать каталог товаров и пополнять остатки товара. В шапке сайта распологаются следующие ссылки:
 "orders", "log out", "add product".  
 orders - при переходе по ссылке пользователь попадает на страницу на которой отображается список id заказов, при нажатии на которые, открывается окно с деталями заказа(id покупателя, id заказа, список продуктов в заказе).    
"add product" - при переходе по ссылке пользовать попадает на страницу на которой отображаются поля для ввода:
- группа товара (выпадающий список)  
- название товара
- цена товара
- количество товара
Кнопка "save".
